<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QMAutomation</title>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
</head>
<body>
<ul id="navbar">
    <li id="navbar-list1" class="navbar-element"><a href="checkin.html">New Gear</a></li>
    <li id="navbar-list2" class="navbar-element"><a href="#">Check out</a></li>
    <li id="navbar-list3" class="navbar-element"><a href="#">Check in</a></li>
</ul>    
<div id="form">
    <form action="Checkout">
           Recipient <input type="text" id="input-person">
          <div id="gear">
           <!-- Type of Gear Input-->
            Type of Gear:
            <select name="gear-type" id="input-gearType">
                    <option value="choose-an-option">Choose an Option</option>
                    <option value="tent">Tent</option>
                    <option value="chef-kit">Chef Kit</option>
                    <option value="cook-kit">Cook Kit</option>
            </select>
        </div>
        <br><br>
        
        <!-- Gear Id Identifier Input-->
        <div id="idNumber">
            Gear Identifier: <input type="text" id="input-idNumber">
        </div>
        <br>
        
        <div id="findReason">
            Reason: <input type="text" id="input-reason"> <br><br>
        </div>
        
        <input id="checkout" type="button" value="Check out">    
    </form>
    
    <div id="jsonTest"></div>
    
    
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.1.1.js"></script>
    
    <script type = "text/javascript">
        var pubkey = "pub-c-c2d65144-cdff-4686-b439-805c13176afc";
        var subkey = "sub-c-8e99e904-fb29-11e6-9c1a-0619f8945a4f";
        
        var todayDate = new Date();
        var dateString = todayDate.getFullYear() + '-' + (todayDate.getDate() + 1) + '-' + todayDate.getMonth();
        
        
        $( "#checkout" ).on( "click", function() {
            var gearType = $("#input-gearType option:selected").text();
            var gearID = $("#input-idNumber").val();
            var reason = $("#input-reason").val();
            var owner = $("#input-person").val();
            var id = guid();
            
            //create the checkin json object
            var record = {
                "id": id,
                "gearType": gearType,
                "gearID": gearID,
                "date": dateString,
                "reason": reason,
                "owner": owner
            };
            
            publish(record);
            console.log(record);
    });
        
    var  publish = function(record){
    // Publish a simple message to the demo_tutorial channel
        var message = {
            "command": "checkout",
            "record": record
        };
        
        pubnubDemo.publish({
            message: message,
            channel: 'database-channel'
        }); 
    }
    
    function guid() {
        //crate a random number within the parameters
        function s4() {
            return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
        }   
        
        //create the final uuid
        return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
        s4() + '-' + s4() + s4() + s4();
    }
    
        var pubnubDemo = new PubNub({
        publishKey:pubkey,
        subscribeKey: subkey
    });

    // Subscribe to the demo_tutorial channel
    pubnubDemo.addListener({
        message: function(message){
        console.log(message);
        var record = message.message.record;

        var recordString = "<p> " + record.name + "</p>";
        $("#jsonTest").html(recordString);
    }
})

pubnubDemo.subscribe({
    channels: ['database_channel']
});

        
        
    </script>
    
    
</body>
</html>