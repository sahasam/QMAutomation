<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QM Checkin Form</title>
</head>
<body>
<div id="navbar-div">
    <ul id="navbar">
        <li id="navbar-list1" class="navbar-element"><a href="#">New Gear</a></li>
        <li id="navbar-list2" class="navbar-element"><a href="checkout.html">Check out</a></li>
        <li id="navbar-list3" class="navbar-element"><a href="checkin.html">Check in</a></li>
    </ul>  
</div>

<form id="checkInInput" action = "Checkin">
     
     <fieldset>
         <legend>Gear Information</legend>
             Type of Gear:
             <select name="gear-type" id="input-gearType">
                     <option value="choose-an-option">Choose an Option</option>
                     <option value="tent">Tent</option>
                     <option value="chef-kit">Chef Kit</option>
                     <option value="cook-kit">Cook Kit</option>
             </select><br><br>


             Gear ID: <input type="text" id="input-gearID"><br><br>
     </fieldset>
    
     <fieldset id="input-quality">
            <legend>Quality of gear returned?</legend>
                <input type="radio" name="quality" value="Excellent">Excellent <br>
                <input type="radio" name="quality" value="Good">Good <br>
                <input type="radio" name="quality" value="Fair">Fair <br>
                <input type="radio" name="quality" value="Poor">Poor <br>
                <input type="radio" name="quality" value="Unusable">Unusable <br>
     </fieldset>
     
     Owner <input type="text" id="recipient">
     
     Comments <br> <textarea id="input-comments" rows="3" cols="50"></textarea>
     
     <br><br><input type="button" value="submit" id="sumbit">
     
</form>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.1.1.js"></script>
<script type = "text/javascript">
    var pubkey = "pub-c-c2d65144-cdff-4686-b439-805c13176afc";
    var subkey = "sub-c-8e99e904-fb29-11e6-9c1a-0619f8945a4f";

    var todayDate = new Date();
    var dateString = todayDate.getFullYear() + '-' + (todayDate.getDate() + 1) + '-' + todayDate.getMonth();


    $( "#sumbit" ).on( "click", function() {
        var gearType = $("#input-gearType option:selected").text();
        var gearID = $("#input-gearID").val();
        var quality = $("input[name='quality']:checked").val();
        var comments = $("#input-comments").val();
        var owner = $("#recipient").val();
        var id = guid();

        //create the checkin json object
        var record = {
            "id": id,
            "gearType": gearType,
            "gearID": gearID,
            "date": dateString,
            "quality": quality,
            "comments": comments,
            "owner": owner
        };
        console.log(record);

        publish(record);
    });
        
    var  publish = function(record){
    // Publish a simple message to the demo_tutorial channel
        var message = {
            "command": "checkin",
            "record": record
        };
        
        pubnubDemo.publish({
            message: message,
            channel: 'database-channel'
        }); 
    }
    
    function guid() {
        //crate a random number within the parameters
        function s4() {
            return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
        }   
        
        //create the final uuid
        return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
        s4() + '-' + s4() + s4() + s4();
    }
    
    var pubnubDemo = new PubNub({
        publishKey:pubkey,
        subscribeKey: subkey
    });

    // Subscribe to the demo_tutorial channel
    pubnubDemo.addListener({
        message: function(message){
            console.log(message);
            var record = message.message.record;

            var recordString = "<p> " + record.name + "</p>";
            $("#jsonTest").html(recordString);
            }
    })

    pubnubDemo.subscribe({
        channels: ['database_channel']
    });

        
        
</script>

    
</body>
</html>